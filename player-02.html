<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Audio Player example</title>
<style type="text/css" media="screen">
 @import 'example.css';
</style>
<script type="text/javascript" src="jquery-1.2.6.min.js "></script>
<script type="text/javascript" src="jquery.audioplayer.js "></script>
<script type="text/javascript" src="jquery.cookieplaylist.js "></script>
<script type="text/javascript" src="jquery.cookie.js "></script>
<script type="text/javascript">

// two playlist are iused.
// the queue holds items sent over from the main window
var queue;
// the playlist holds the real current playlist
var playlist;

function updatePlaylist( id ){
	// shell function
	console.log( 'item for list: ' + id );
}

function checkPlaylistQueue(){
	if( queue.count() ){
		updatePlaylist( queue.pop() );
	}
	return true;
}

$.periodic( checkPlaylistQueue, { frequency: 1 } );

jQuery(document).ready(function(){

	// initialise our cookie playlists
	queue = $.cookiePlaylist.initialise( 'audio_playlist_queue' );
	playlist 	= $.cookiePlaylist.initialise();

	// register our cleanup function
	// do stuff when the play window is closed
	$(window).unload( function () {
		$.cookie('audioPlayerOpen', null);
	});

	/*
		Set a cookie so that the parent window knows that we are open.

		We have to signal via cookies as the user might have moved to another
		page in the parent window since the player was opened.

		This is a valid action - the user might be listening to  audio, and we
		don't want to reload new content into the same window if they click
		on another link but instead pass the new URL via a function call.

		Apart from saving on traffic, this will allow a future playlist
		functionality to work correctly.
	*/
	var time = new Date();
	var now = Math.floor(time.getTime()/1000);
	$.cookie('audioPlayerOpen', now, {expires: 1, path: '/'});

	// events must always come first as DOM elements could be updated from the initialise function
	// e.g. the time and volume DOM containers

	$(document).bind('soundVolumeChange', function(e, m){
		$('#volume').html( m.volume + '%' );
	});

	$(document).bind('soundStop soundPause', function(e, m){
		$('#play').removeClass( 'playing');
	});

	$(document).bind('soundPlay', function(e, m){
		$('#play').addClass( 'playing');
	});

	$(document).bind('soundMessage', function(e, m){
		alert(m.message);
	});

	$(document).bind('soundPositionChange', function(e, m){
		$(".seconds").html( m.position );
	});

	$.audioPlayer.initialise( {
			mp3Player			: "audioplayer.swf",
			expressPlayer	: "expressInstall.swf",
	});


	$('#play').click( function(){
		if( $.audioPlayer.isPlaying()){
			$.audioPlayer.pause();
		}
		else{
			$.audioPlayer.play(0);
		}
	});

	$('#stop').click( function(){
		$.audioPlayer.stop();
	});

   $('#quieter').click( function(){
		$.audioPlayer.quieter();
	});

   $('#louder').click( function(){
		$.audioPlayer.louder();
	});


})

</script>
</head>
<body>
	<h1>Audio Player</h1>
	<div id="player-wrapper">
		<!-- Section for displaying data about the item -->
		<div id="playlist">
			<h2 class="hide">Current Item</h2>
			<ul class="items">
				<li><span class="title">This is the title of the item up to 64 characters in width  XXXX</span><span class="hide"> - </span>
						<span class="desc">This is the description of the item and can be up to 128 chars, which is a lot longer than the title and would extent out to here X.</span></li>
			</ul>
		</div>

		<!-- Section for showing the current clip time -->
		<div id="time-wrapper">
			<h2 class="hide">Current time</h2>
			<div id="counter">
	  		<div class="seconds">0:00</div>
			</div>
		</div>

		<div id="player">
	  	<h2 class="hide">Player Controls</h2>
	  	<ul id="controls">
		  	<!-- li><input width="50" type="image" height="50" alt="Last" src="0.gif" id="last"/></li -->
		  	<li><input type="image" alt="Stop" src="0.gif" id="stop"/></li>
		  	<li><input type="image" alt="Play/Pause" src="0.gif" id="play" class="play"/></li>
		  	<!-- li><input type="image" alt="Pause" src="0.gif" id="pause"/></li -->
		  	<!-- li><input type="image" alt="Next" src="0.gif" id="next"/></li -->
		  	<li><input type="image" height="50" alt="Quieter" src="0.gif" id="quieter"/></li>
		  	<li><input type="image" alt="Louder" src="0.gif" id="louder"/></li>
	  	</ul>
		</div>
	</div>

	<div id="volume">

	</div>

</body>
</html>